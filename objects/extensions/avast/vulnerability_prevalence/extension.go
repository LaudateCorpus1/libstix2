package vulnerability_prevalence

import (
	"time"

	"github.com/avast/libstix2/objects/extensions/definition"
)

const Id = "extension-definition--caf140bb-de34-4c50-a4fc-5ca201e0c380"

const (
	PropVulnerabilityRef      = "x_avast_com_vulnerability_ref"
	PropRegionalPrevalenceMap = "x_avast_com_regional_prevalence_map"
)

func ExtensionDefinition() *definition.Definition {
	created, err := time.Parse(time.RFC3339, "2021-04-14T10:18:00+01:00")
	if err != nil {
		panic(err)
	}

	def := definition.New()
	def.SetID(Id)
	def.SetName("Vulnerability Prevalence Extension")
	def.SetDescription("A vulnerability prevalence object defines how prevalent a vulnerability is occurring across both geographic and malware instances.")
	def.Version = "1.0"
	def.SetCreated(created)
	def.SetModified(created)
	def.Schema = "" // TODO
	def.ExtensionTypes = append(def.ExtensionTypes, definition.ExtensionProperty)
	def.ExtensionProperties = []string{PropVulnerabilityRef, PropRegionalPrevalenceMap}
	return def
}

type VulnerabilityPrevalence struct {
	VulnerabilityRef      string           `json:"x_avast_com_vulnerability_ref,omitempty"`
	RegionalPrevalenceMap map[string]int64 `json:"x_avast_com_regional_prevalence_map,omitempty"`
}
